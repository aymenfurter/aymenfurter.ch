<section id="experience">
    <div class="section-header">
        <h2>Professional Experience</h2>
        <p class="section-subtitle">My professional journey in technology</p>
    </div>
    
    {{/* Define career data */}}
    {{ $careers := slice
        (dict "company" "boxalino" "name" "Boxalino" "start" "2007-05" "end" "2014-12")
        (dict "company" "prodyna" "name" "PRODYNA" "start" "2015-01" "end" "2017-05")
        (dict "company" "zurich" "name" "Zurich" "start" "2017-06" "end" "2022-08")
        (dict "company" "microsoft" "name" "Microsoft" "start" "2022-09" "end" "present")
    }}
    
    {{ $startYear := 2007 }}
    {{ $currentYear := int (now.Format "2006") }}
    {{ $currentMonth := int (now.Format "1") }}
    
    {{ $yearCount := add (sub $currentYear $startYear) 1 }}
    <div class="experience-layout" style="--year-count: {{ $yearCount }};">
        <!-- Company Selector (visible on mobile) -->
        <div class="company-selector-mobile">
            <div class="career-legend">
                {{ range $careers }}
                <div class="legend-item{{ if eq .company "microsoft" }} active{{ end }}" data-company="{{ .company }}"><span class="legend-box {{ .company }}"></span>{{ .name }}</div>
                {{ end }}
            </div>
        </div>
        
        <!-- Left side: Timeline Grid + Legend -->
        <div class="experience-sidebar">
            <div class="career-timeline">
                <div class="timeline-header">
                    <span class="month-spacer"></span>
                    {{ range $year := seq $startYear $currentYear }}
                    <span>'{{ printf "%02d" (mod $year 100) }}</span>
                    {{ end }}
                </div>
                <div class="career-grid-wrapper">
                    <div class="month-labels">
                        <span>Jan</span><span>Feb</span><span>Mar</span><span>Apr</span><span>May</span><span>Jun</span><span>Jul</span><span>Aug</span><span>Sep</span><span>Oct</span><span>Nov</span><span>Dec</span>
                    </div>
                    <div class="career-grid">
                        {{/* Generate 12 rows (one for each month) */}}
                        {{ range $monthIdx := seq 1 12 }}
                        <!-- Row {{ $monthIdx }} ({{ index (slice "" "Jan" "Feb" "Mar" "Apr" "May" "Jun" "Jul" "Aug" "Sep" "Oct" "Nov" "Dec") $monthIdx }}) -->
                        {{ range $year := seq $startYear $currentYear }}
                            {{/* Check if this month is in the future */}}
                            {{ $isFuture := or (gt $year $currentYear) (and (eq $year $currentYear) (gt $monthIdx $currentMonth)) }}
                            {{/* Find which company was active this month */}}
                            {{ $activeCompany := "" }}
                            {{ if not $isFuture }}
                                {{ $checkDate := printf "%d-%02d" $year $monthIdx }}
                                {{ range $careers }}
                                    {{ $startDate := .start }}
                                    {{ $endDate := .end }}
                                    {{ $isAfterStart := ge $checkDate $startDate }}
                                    {{ $isBeforeEnd := or (eq $endDate "present") (le $checkDate $endDate) }}
                                    {{ if and $isAfterStart $isBeforeEnd }}
                                        {{ $activeCompany = .company }}
                                    {{ end }}
                                {{ end }}
                            {{ end }}
                            {{ if $isFuture }}
                            <div class="career-month future"></div>
                            {{ else if $activeCompany }}
                            <div class="career-month {{ $activeCompany }}" data-company="{{ $activeCompany }}"></div>
                            {{ else }}
                            <div class="career-month empty"></div>
                            {{ end }}
                        {{ end }}
                        {{ end }}
                    </div>
                </div>
                <div class="career-legend">
                    {{ range $careers }}
                    <div class="legend-item{{ if eq .company "microsoft" }} active{{ end }}" data-company="{{ .company }}"><span class="legend-box {{ .company }}"></span>{{ .name }}</div>
                    {{ end }}
                </div>
            </div>
        </div>

        <!-- Right side: Company Detail View -->
        <div class="experience-detail-panel">
            <!-- Microsoft -->
            <div class="experience-detail active" data-company="microsoft">
                <div class="detail-header">
                    <div class="company-logo microsoft">
                        <svg viewBox="0 0 23 23" width="40" height="40"><rect x="1" y="1" width="10" height="10" fill="#f25022"/><rect x="12" y="1" width="10" height="10" fill="#7fba00"/><rect x="1" y="12" width="10" height="10" fill="#00a4ef"/><rect x="12" y="12" width="10" height="10" fill="#ffb900"/></svg>
                    </div>
                    <div class="detail-title">
                        <h3>Microsoft</h3>
                        <span class="detail-period">Sep 2022 – Present</span>
                        <span class="detail-location">Zurich, Switzerland</span>
                    </div>
                    <span class="current-badge">Current</span>
                </div>
                <div class="detail-roles">
                    <div class="detail-role">
                        <h4>Solution Engineer</h4>
                        <span class="role-period">Mar 2025 – Present</span>
                        <ul class="role-highlights">
                            <li>Designing cloud-native architectures and AI agent implementations for Swiss enterprises through hands-on prototyping and deep-dive technical sessions</li>
                            <li>Evangelizing coding agents and LLM-powered developer workflows, helping engineering teams integrate tools like GitHub Copilot into their SDLC</li>
                            <li>Building proof-of-concepts for RAG pipelines, MCP integrations, and agentic systems on Azure infrastructure</li>
                        </ul>
                    </div>
                    <div class="detail-role">
                        <h4>Cloud Solution Architect</h4>
                        <span class="role-period">Sep 2022 – Feb 2025</span>
                        <ul class="role-highlights">
                            <li>Architected Azure landing zones, containerized workloads, and AI integration patterns through hackathons and architecture design sessions</li>
                            <li>Built agent-based code review platform and investigation tooling with structured evaluation frameworks and observability hooks</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Zurich Insurance -->
            <div class="experience-detail" data-company="zurich">
                <div class="detail-header">
                    <div class="detail-title">
                        <h3>Zurich Insurance Group</h3>
                        <span class="detail-period">Jun 2017 – Aug 2022</span>
                        <span class="detail-location">Zurich, Switzerland</span>
                    </div>
                </div>
                <div class="detail-roles">
                    <div class="detail-role">
                        <h4>Tech Lead / Platform Architect</h4>
                        <span class="role-period">Jun 2017 – Aug 2022</span>
                        <ul class="role-highlights">
                            <li>Architected large-scale API gateway and microservices infrastructure handling 2M+ monthly transactions</li>
                            <li>Led cloud migration initiatives moving critical workloads to Azure</li>
                            <li>Operated and maintained business-critical Kubernetes clusters</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- PRODYNA -->
            <div class="experience-detail" data-company="prodyna">
                <div class="detail-header">
                    <div class="detail-title">
                        <h3>PRODYNA (Schweiz) AG</h3>
                        <span class="detail-period">Jan 2015 – May 2017</span>
                        <span class="detail-location">Zurich, Switzerland</span>
                    </div>
                </div>
                <div class="detail-roles">
                    <div class="detail-role">
                        <h4>IT Consultant</h4>
                        <span class="role-period">Jan 2015 – May 2017</span>
                        <ul class="role-highlights">
                            <li>Delivered expert consulting on software architecture for enterprise clients</li>
                            <li>Designed APIs and integration solutions using Java and Apache Camel</li>
                            <li>Implemented microservices architectures for financial services clients</li>
                        </ul>
                    </div>
                </div>
            </div>

            <!-- Boxalino -->
            <div class="experience-detail" data-company="boxalino">
                <div class="detail-header">
                    <div class="detail-title">
                        <h3>Boxalino AG</h3>
                        <span class="detail-period">May 2007 – Dec 2014</span>
                        <span class="detail-location">Zurich, Switzerland</span>
                    </div>
                </div>
                <div class="detail-roles">
                    <div class="detail-role">
                        <h4>Senior Java Developer</h4>
                        <span class="role-period">May 2007 – Dec 2014</span>
                        <ul class="role-highlights">
                            <li>Led development of e-government and B2B/B2C platforms using Java, modern frontend frameworks, and REST APIs</li>
                            <li>Built native iOS and hybrid mobile applications</li>
                            <li>Designed and implemented scalable backend systems</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const legendItems = document.querySelectorAll('.career-legend .legend-item');
    const gridCells = document.querySelectorAll('.career-month[data-company]');
    const detailPanels = document.querySelectorAll('.experience-detail');
    
    function switchCompany(company) {
        // Update legend active state
        legendItems.forEach(item => {
            item.classList.toggle('active', item.dataset.company === company);
        });
        
        // Dim non-selected grid cells
        gridCells.forEach(cell => {
            cell.classList.toggle('dimmed', cell.dataset.company !== company);
        });
        
        // Switch detail panel
        detailPanels.forEach(panel => {
            panel.classList.toggle('active', panel.dataset.company === company);
        });
    }
    
    // Click handlers for legend items
    legendItems.forEach(item => {
        item.addEventListener('click', () => switchCompany(item.dataset.company));
    });
    
    // Click handlers for grid cells
    gridCells.forEach(cell => {
        cell.addEventListener('click', () => {
            if (cell.dataset.company) {
                switchCompany(cell.dataset.company);
            }
        });
    });
    
    // Initialize with Microsoft highlighted
    switchCompany('microsoft');
});
</script>